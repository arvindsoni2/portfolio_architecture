%%{init: {
  "theme": "base",
  "themeVariables": {
    "primaryColor": "#DEEAF1",
    "primaryTextColor": "#1A1A1A",
    "primaryBorderColor": "#2E75B6",
    "lineColor": "#2E75B6",
    "secondaryColor": "#F0F4F8",
    "tertiaryColor": "#EAF3EA",
    "background": "#FFFFFF",
    "fontSize": "14px",
    "fontFamily": "Arial"
  }
}}%%

flowchart TB

    %% â”€â”€ CLIENT LAYER â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
    subgraph CLIENTS["ğŸ‘·  Client Layer  â€”  2,000+ Field Engineers  &amp;  Office Admins"]
        direction LR
        IOS["ğŸ“± iOS App<br/>TLS 1.2 + cert pinning"]
        AND["ğŸ¤– Android App<br/>TLS 1.2 + cert pinning"]
        WEB["ğŸŒ Web Portal<br/>HTTPS / RBAC"]
    end

    %% â”€â”€ AWS EDGE â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
    subgraph EDGE["â˜ï¸  AWS  eu-west-2  â€”  Edge &amp; Identity"]
        direction LR
        WAF["ğŸ›¡ï¸ WAF + DDoS Protection<br/>IP allowlisting Â· Threat rules"]
        ALB["âš–ï¸ Application Load Balancer<br/>HTTPS termination Â· SSL offload"]
        SAML["ğŸ”‘ SAML 2.0 / SSO<br/>Active Directory federation<br/>Identity provider (on-prem AD)"]
    end

    %% â”€â”€ AWS APPLICATION TIER â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
    subgraph AWSAPP["â˜ï¸  AWS  â€”  VPC  Private Subnets  â€”  Application Tier"]
        direction LR
        OS["âš¡ OutSystems Platform<br/>Low-code Â· Business logic<br/>Timesheet &amp; Claims workflows"]
        APIG["ğŸ”Œ Internal API Gateway<br/>REST endpoints<br/>Routing Â· Auth Â· Rate limiting"]
        IAM["ğŸ”‘ IAM<br/>Least-privilege roles<br/>Resource-level policies"]
    end

    %% â”€â”€ AWS DATA LAYER â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
    subgraph AWSDATA["ğŸ’¾  AWS  â€”  Data Layer  (Encrypted at Rest)"]
        direction LR
        RDS["ğŸ—„ï¸ RDS PostgreSQL<br/>Application state<br/>AES-256 Â· Multi-AZ"]
        S3["ğŸª£ S3<br/>Docs &amp; Attachments<br/>SSE-S3 Â· Versioning"]
        CW["ğŸ“ˆ CloudWatch<br/>Logs Â· Metrics<br/>Alerts"]
    end

    %% â”€â”€ HYBRID BOUNDARY â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
    subgraph HYBRID["ğŸ”  Hybrid Boundary  â€”  Encrypted Integration Layer"]
        direction LR
        VPN["ğŸ”— AWS Site-to-Site VPN<br/>IPSec encrypted tunnel<br/>AWS â†” NPG Data Centre"]
        OPGW["ğŸšª On-Premise API Gateway<br/>SOAP â†” REST translation<br/>Throttling Â· Auth"]
    end

    %% â”€â”€ ON-PREMISE â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
    subgraph ONPREM["ğŸ­  On-Premise  â€”  Northern Powergrid Data Centre"]
        direction LR
        HCM["ğŸ“‹ Oracle HCM<br/>HR &amp; Workforce Mgmt<br/>Timesheet validation"]
        CRM["ğŸ“ Oracle CRM<br/>Asset &amp; Work Orders<br/>Customer records"]
        ONCW["ğŸ“Š Audit &amp; Compliance Logs<br/>GDPR data flow records<br/>CAB change log"]
    end

    %% â”€â”€ OUTCOMES â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
    subgraph OUT["ğŸ†  Architecture Outcomes  â€”  Year 1"]
        direction LR
        O1["ğŸ’° Â£500K<br/>annual savings"]
        O2["ğŸ“‰ 50%<br/>fewer office visits"]
        O3["â±ï¸ 6-month<br/>delivery"]
        O4["ğŸ”’ Zero GDPR<br/>incidents"]
        O5["ğŸ‘· 2,000+<br/>engineers live"]
    end

    %% â”€â”€ FLOWS â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€

    %% Client â†’ Edge
    IOS & AND -->|"HTTPS Â· TLS 1.2<br/>Certificate pinning"| WAF
    WEB -->|"HTTPS"| WAF
    WAF --> ALB
    SAML -->|"SAML assertion<br/>(identity token)"| ALB

    %% Edge â†’ App
    ALB --> OS
    OS <-->|"Internal calls"| APIG
    IAM -.->|"Least privilege<br/>controls"| APIG & RDS & S3

    %% App â†’ Data
    APIG --> RDS
    APIG --> S3
    CW -.->|"Monitors"| OS & APIG & RDS

    %% App â†’ Hybrid boundary â†’ On-prem
    APIG -->|"Oracle REST calls<br/>via VPN tunnel"| VPN
    VPN <-->|"IPSec tunnel"| OPGW
    OPGW -->|"SOAP / XML"| HCM
    OPGW -->|"REST / JSON"| CRM
    ONCW -.->|"Audit feed"| ONPREM

    %% Outcomes
    AWSAPP & ONPREM --> OUT

    %% â”€â”€ STYLES â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
    classDef clientStyle  fill:#FFF8DC,stroke:#DAA520,color:#1A1A1A
    classDef edgeStyle    fill:#E3F2FD,stroke:#1565C0,color:#1A1A1A
    classDef appStyle     fill:#EDE7F6,stroke:#7B1FA2,color:#1A1A1A
    classDef dataStyle    fill:#E8F5E9,stroke:#388E3C,color:#1A1A1A
    classDef hybStyle     fill:#FCE4EC,stroke:#C62828,color:#1A1A1A
    classDef onpremStyle  fill:#EFEBE9,stroke:#4E342E,color:#1A1A1A
    classDef outStyle     fill:#E8F5E9,stroke:#2E7D32,color:#1A1A1A

    class IOS,AND,WEB clientStyle
    class WAF,ALB,SAML edgeStyle
    class OS,APIG,IAM appStyle
    class RDS,S3,CW dataStyle
    class VPN,OPGW hybStyle
    class HCM,CRM,ONCW onpremStyle
    class O1,O2,O3,O4,O5 outStyle
